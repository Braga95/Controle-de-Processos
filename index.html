<script>
    // Variáveis globais
    let currentTab = 'qrcode';
    let isAdminLoggedIn = false;
    let cartItems = [];
    let products = [
        { id: 1, name: 'Cachorro Quente', price: 10.00 },
        { id: 2, name: 'Hambúrguer', price: 15.00 },
        { id: 3, name: 'Refrigerante', price: 5.00 },
        { id: 4, name: 'Batata Frita', price: 8.00 }
    ];
    let orders = [];
    let bankInfo = { name: '', pix: '' };
    let balance = 0;

    // DOM Elements
    const adminBtn = document.getElementById('adminBtn');
    const loginModal = document.getElementById('loginModal');
    const closeLogin = document.getElementById('closeLogin');
    const loginForm = document.getElementById('loginForm');
    const adminPanel = document.getElementById('adminPanel');
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const startScanBtn = document.getElementById('startScan');
    const stopScanBtn = document.getElementById('stopScan');
    const scannerElement = document.getElementById('scanner');

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
        renderProducts();
        
        // Admin button click
        adminBtn.addEventListener('click', () => {
            if (isAdminLoggedIn) {
                adminPanel.style.display = 'block';
            } else {
                loginModal.style.display = 'block';
            }
        });

        // Close login modal
        closeLogin.addEventListener('click', () => {
            loginModal.style.display = 'none';
        });

        // Login form submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'lpalmeira' && password === '123') {
                isAdminLoggedIn = true;
                loginModal.style.display = 'none';
                adminPanel.style.display = 'block';
            } else {
                alert('Usuário ou senha incorretos!');
            }
        });

        // Tab switching
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        // Start scan button
        startScanBtn.addEventListener('click', () => {
            startScanBtn.style.display = 'none';
            stopScanBtn.style.display = 'inline-block';
            scannerElement.innerHTML = '<p style="text-align: center; padding: 50px;">Simulação de câmera de escaneamento</p>';
        });

        // Stop scan button
        stopScanBtn.addEventListener('click', () => {
            startScanBtn.style.display = 'inline-block';
            stopScanBtn.style.display = 'none';
            scannerElement.innerHTML = '';
            
            // Simulate scanning a QR code
            const randomOrder = Math.floor(Math.random() * 1000);
            alert(`Pedido #${randomOrder} escaneado com sucesso!`);
        });
    });

    // Functions
    function switchTab(tabId) {
        // Update active tab button
        tabBtns.forEach(btn => {
            btn.classList.remove('active');
            if (btn.getAttribute('data-tab') === tabId) {
                btn.classList.add('active');
            }
        });

        // Update active tab content
        tabContents.forEach(content => {
            content.classList.remove('active');
            if (content.id === tabId) {
                content.classList.add('active');
            }
        });

        currentTab = tabId;
    }

    function renderProducts() {
        const productsContainer = document.querySelector('.products-container');
        if (productsContainer) {
            productsContainer.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-img">${product.name.charAt(0)}</div>
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <p class="product-price">R$ ${product.price.toFixed(2)}</p>
                        <div class="quantity-controls">
                            <button class="quantity-btn" onclick="decreaseQuantity(${product.id})">-</button>
                            <span class="quantity-value" id="qty-${product.id}">0</span>
                            <button class="quantity-btn" onclick="increaseQuantity(${product.id})">+</button>
                        </div>
                    </div>
                `;
                productsContainer.appendChild(productCard);
            });
        }
    }

    // Global functions for quantity controls
    window.increaseQuantity = function(productId) {
        const product = products.find(p => p.id === productId);
        const quantityElement = document.getElementById(`qty-${productId}`);
        let quantity = parseInt(quantityElement.textContent) || 0;
        quantity++;
        quantityElement.textContent = quantity;
        
        // Add to cart
        const existingItem = cartItems.find(item => item.product.id === productId);
        if (existingItem) {
            existingItem.quantity = quantity;
        } else {
            cartItems.push({ product, quantity });
        }
        
        updateCart();
    };

    window.decreaseQuantity = function(productId) {
        const quantityElement = document.getElementById(`qty-${productId}`);
        let quantity = parseInt(quantityElement.textContent) || 0;
        if (quantity > 0) {
            quantity--;
            quantityElement.textContent = quantity;
            
            // Update or remove from cart
            const existingItemIndex = cartItems.findIndex(item => item.product.id === productId);
            if (existingItemIndex !== -1) {
                if (quantity === 0) {
                    cartItems.splice(existingItemIndex, 1);
                } else {
                    cartItems[existingItemIndex].quantity = quantity;
                }
            }
            
            updateCart();
        }
    };

    function updateCart() {
        const cartItemsElement = document.getElementById('cart-items');
        const cartTotalElement = document.getElementById('cart-total');
        
        if (cartItemsElement && cartTotalElement) {
            cartItemsElement.innerHTML = '';
            let total = 0;
            
            cartItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <span class="item-name">${item.product.name} x${item.quantity}</span>
                    <span class="item-price">R$ ${(item.product.price * item.quantity).toFixed(2)}</span>
                `;
                cartItemsElement.appendChild(itemElement);
                total += item.product.price * item.quantity;
            });
            
            cartTotalElement.textContent = `R$ ${total.toFixed(2)}`;
        }
    }
</script>
